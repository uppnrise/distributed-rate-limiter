spring.application.name=distributed-rate-limiter

# Rate Limiter Configuration

# Default limits (applied to all keys unless overridden)
ratelimiter.capacity=10
ratelimiter.refillRate=2
ratelimiter.cleanupIntervalMs=60000

# Per-key overrides (exact key matching)
# Example: Premium users get higher limits
# ratelimiter.keys.premium_user.capacity=50
# ratelimiter.keys.premium_user.refillRate=10

# Pattern-based configurations (supports * wildcard)
# Example: All user keys get moderate limits
# ratelimiter.patterns.user:*.capacity=20
# ratelimiter.patterns.user:*.refillRate=5

# Example: All API keys get high limits  
# ratelimiter.patterns.api:*.capacity=100
# ratelimiter.patterns.api:*.refillRate=50

# FixedWindow algorithm test configuration (commented out - use REST API instead)
# ratelimiter.patterns.fixed:*.capacity=3
# ratelimiter.patterns.fixed:*.refillRate=1
# ratelimiter.patterns.fixed:*.algorithm=FIXED_WINDOW

# Example: Admin keys get unlimited-like limits
# ratelimiter.patterns.*:admin.capacity=1000
# ratelimiter.patterns.*:admin.refillRate=500

# Redis Configuration for Distributed Rate Limiting
ratelimiter.redis.enabled=true

# Redis connection settings (uses Spring Boot Redis auto-configuration)
# spring.data.redis.host=localhost
# spring.data.redis.port=6379
# spring.data.redis.password=
# spring.data.redis.database=0

# Redis Connection Pool Configuration for Performance
# Lettuce pool settings for better connection management
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=5000ms
spring.data.redis.lettuce.pool.time-between-eviction-runs=30s

# Actuator endpoints for monitoring
management.endpoints.web.exposure.include=health,info,metrics

# Security Configuration
# API Key Configuration
ratelimiter.security.api-keys.enabled=true
ratelimiter.security.api-keys.valid-keys=api-key-1,api-key-2,premium-key-123

# IP-based Security Configuration
ratelimiter.security.ip.whitelist=127.0.0.1,::1
ratelimiter.security.ip.blacklist=

# Request Size Limits
ratelimiter.security.max-request-size=1MB

# Security Headers
ratelimiter.security.headers.enabled=true

# Logging Configuration
logging.level.root=INFO
logging.level.ratelimiter=INFO
logging.level.monitoring=INFO
logging.level.dev.bnacar.distributedratelimiter.ratelimit=INFO
logging.level.dev.bnacar.distributedratelimiter.monitoring=INFO
logging.level.dev.bnacar.distributedratelimiter.observability=DEBUG

# Observability Configuration
observability.correlation-id.enabled=true
observability.tracing.enabled=true
observability.structured-logging.enabled=true

# Geographic Rate Limiting Configuration
ratelimiter.geographic.enabled=true
ratelimiter.geographic.ip-database-path=/data/GeoLite2-City.mmdb
ratelimiter.geographic.update-interval-hours=24
ratelimiter.geographic.cache-size=10000
ratelimiter.geographic.cache-ttl-hours=1

# Example geographic rate limiting rules (uncomment to enable)
# EU/GDPR region limits
# ratelimiter.geographic.rules[0].name=eu-gdpr-limits
# ratelimiter.geographic.rules[0].region=EU
# ratelimiter.geographic.rules[0].compliance-zone=GDPR
# ratelimiter.geographic.rules[0].key-pattern=api:*
# ratelimiter.geographic.rules[0].capacity=500
# ratelimiter.geographic.rules[0].refill-rate=50
# ratelimiter.geographic.rules[0].priority=100

# US premium region limits  
# ratelimiter.geographic.rules[1].name=us-premium-limits
# ratelimiter.geographic.rules[1].country-code=US
# ratelimiter.geographic.rules[1].key-pattern=api:*
# ratelimiter.geographic.rules[1].capacity=2000
# ratelimiter.geographic.rules[1].refill-rate=200
# ratelimiter.geographic.rules[1].priority=90

# High-risk countries (more restrictive limits)
# ratelimiter.geographic.rules[2].name=high-risk-countries
# ratelimiter.geographic.rules[2].countries=CN,RU,KP
# ratelimiter.geographic.rules[2].key-pattern=*
# ratelimiter.geographic.rules[2].capacity=100
# ratelimiter.geographic.rules[2].refill-rate=10
# ratelimiter.geographic.rules[2].priority=110
